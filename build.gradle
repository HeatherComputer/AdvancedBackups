/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java-library'
    id 'maven-publish'
    id 'io.github.patrick.remapper' version "1.4.2"
}

group = 'computer.heather.AdvancedBackups'
description = 'AdvancedBackups'
java.sourceCompatibility = JavaVersion.VERSION_21

base {
    archivesName = 'AdvancedBackups-' + modloaderName + "-" + minecraftVersion
}

repositories {
    maven {
        url = uri('https://hub.spigotmc.org/nexus/content/repositories/snapshots/')
    }

    maven {
        url = uri('https://repo.maven.apache.org/maven2/')
    }
    mavenCentral()
    mavenLocal()
}

configurations {
    // configuration that holds jars to include in the jar
    extraLibs
}

dependencies {
    compileOnly("org.spigotmc:spigot:1.21-R0.1-SNAPSHOT:remapped-mojang")

    implementation files ('advancedbackups-corelib.jar')
    extraLibs files ('advancedbackups-corelib.jar')
}



tasks.withType(ProcessResources).configureEach {
    var replaceProperties = [
        version: version
    ]
    inputs.properties replaceProperties

    filesMatching(['plugin.yml']) {
        expand replaceProperties + [project: project]
    }
}

// Example for how to get properties into the manifest for reading at runtime.
tasks.named('jar', Jar).configure {
    manifest {
        attributes([
                "Main-Class"              : "co.uk.mommyheather.advancedbackups.cli.AdvancedBackupsCLI",
                "Specification-Title"     : "advancedbackups",
                "Specification-Vendor"    : "mommyheather",
                "Specification-Version"   : "1", // We are version 1 of ourselves
                "Implementation-Title"    : project.name,
                "Implementation-Version"  : project.jar.archiveVersion,
                "Implementation-Vendor"   : "mommyheather",
                "Implementation-Timestamp": new Date().format("yyyy-MM-dd'T'HH:mm:ssZ")
        ])
    }    
    from {
            configurations.extraLibs.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

tasks {
    remap {
        version.set("1.21")
    }
    build {
        dependsOn(remap)
    }
}

publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}
